# 微信小程序使用指南

## 前置要求

1. **安装 Node.js**（版本 14 或更高）
2. **安装微信开发者工具**（从微信公众平台下载）
3. **手机和电脑需要在同一局域网**（WiFi）

## 步骤一：启动后端服务器

### 1. 安装依赖（如果还没安装）
```bash
cd /Users/anyunbin/LLM/booking
npm install
```

### 2. 启动服务器
```bash
npm start
```

或者使用开发模式（自动重启）：
```bash
npm run dev
```

服务器会在 `http://localhost:3000` 启动。

### 3. 获取本机IP地址
在终端运行以下命令获取本机IP：
```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1

# Windows
ipconfig
```

记录下你的IP地址，例如：`192.168.1.100`

## 步骤二：配置小程序API地址

### 1. 修改 app.js 中的 API 地址

打开 `app.js` 文件，将 `apiBaseUrl` 改为你的本机IP地址：

```javascript
// app.js
this.globalData = {
  userId: null,
  apiBaseUrl: 'http://192.168.1.100:3000/api'  // 替换为你的IP地址
}
```

**重要提示：**
- 将 `192.168.1.100` 替换为你实际的IP地址
- 确保手机和电脑连接在同一个WiFi网络
- 如果IP地址变化，需要重新修改

### 2. 配置微信开发者工具

1. 打开微信开发者工具
2. 导入项目：
   - 项目目录：选择 `/Users/anyunbin/LLM/booking`
   - AppID：使用测试号或你的小程序AppID
   - 项目名称：booking

3. **重要配置**：
   - 在"设置" → "项目设置" → "本地设置"中
   - ✅ 勾选"不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书"
   - 这样可以在开发时使用 HTTP 协议

## 步骤三：在手机上预览

### 方法一：使用微信开发者工具预览

1. 确保后端服务器正在运行（步骤一）
2. 在微信开发者工具中点击"预览"按钮
3. 用微信扫描二维码
4. 在手机上打开小程序

### 方法二：真机调试

1. 确保后端服务器正在运行
2. 在微信开发者工具中点击"真机调试"按钮
3. 用微信扫描二维码
4. 在手机上打开小程序，可以查看调试信息

## 步骤四：测试连接

1. 在手机上打开小程序
2. 尝试创建日程或查看好友列表
3. 如果出现网络错误，检查：
   - 后端服务器是否正在运行
   - IP地址是否正确
   - 手机和电脑是否在同一WiFi网络
   - 防火墙是否阻止了3000端口

## 常见问题

### 1. 无法连接服务器
- **检查IP地址**：确保使用正确的本机IP，不是localhost
- **检查网络**：确保手机和电脑在同一WiFi
- **检查防火墙**：确保3000端口没有被阻止
- **检查服务器**：确保后端服务器正在运行

### 2. 预览二维码无法扫描
- 确保微信版本是最新的
- 尝试使用真机调试功能

### 3. 数据不显示
- 检查后端服务器日志，查看是否有错误
- 确保数据库已正确初始化
- 检查API请求是否成功（在开发者工具的网络面板查看）

### 4. IP地址变化
如果电脑重新连接WiFi，IP地址可能会变化，需要：
1. 重新获取IP地址
2. 更新 `app.js` 中的 `apiBaseUrl`
3. 重新编译小程序

## 生产环境部署

如果要部署到生产环境，需要：

1. **部署后端服务器**到云服务器（如阿里云、腾讯云等）
2. **使用HTTPS协议**（小程序要求）
3. **配置域名**并在微信公众平台配置服务器域名
4. **修改app.js**中的API地址为生产环境地址

## 快速启动脚本

可以创建一个启动脚本来自动获取IP并启动服务器：

```bash
#!/bin/bash
# start.sh

# 获取本机IP
IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')
echo "本机IP地址: $IP"
echo "请在 app.js 中设置 apiBaseUrl 为: http://$IP:3000/api"
echo ""
echo "启动服务器..."
npm start
```

保存为 `start.sh`，然后运行：
```bash
chmod +x start.sh
./start.sh
```

