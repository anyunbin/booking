# 环境变量配置说明

## 概述

本项目使用环境变量来存储敏感信息（如管理员密码），这样可以避免将密码硬编码在代码中。

## 环境变量列表

### ADMIN_PASSWORD（管理员密码）

**用途**：保护管理后台 API 的访问

**默认值**：`admin123`（仅用于开发）

**设置方式**：

#### 方式 1：在微信云托管中设置（推荐）

1. 登录 [微信云托管控制台](https://console.cloud.tencent.com/tcb)
2. 进入你的服务 → **服务设置**
3. 找到 **环境变量** 部分
4. 添加新的环境变量：
   ```
   变量名: ADMIN_PASSWORD
   变量值: your-secure-password-here
   ```
5. 保存并重新部署服务

#### 方式 2：在本地开发中设置

创建 `.env` 文件（不要上传到 GitHub）：

```bash
ADMIN_PASSWORD=your-secure-password-here
```

然后在 `server/index.js` 中加载：

```javascript
require('dotenv').config()
```

#### 方式 3：在启动命令中设置

```bash
ADMIN_PASSWORD=your-secure-password-here node server/index.js
```

## 使用示例

### 后端代码中使用

```javascript
const adminPassword = process.env.ADMIN_PASSWORD || 'admin123'
```

### 前端访问管理后台

**方式 1：在请求头中提供密码（推荐）**

```javascript
fetch('/api/admin/stats', {
  headers: {
    'x-admin-password': 'your-admin-password'
  }
})
```

**方式 2：在 URL 中提供密码（仅用于测试）**

```
https://your-domain.com/api/admin/stats?adminPassword=your-admin-password
```

## 安全建议

### ✅ 应该做的

1. **使用强密码**
   ```
   ✅ MySecureAdminPass2025!@#
   ❌ admin123
   ❌ password
   ```

2. **定期更换密码**
   - 每 3 个月更换一次
   - 在环境变量中更新

3. **不要在代码中硬编码密码**
   ```javascript
   ❌ const password = "admin123"
   ✅ const password = process.env.ADMIN_PASSWORD
   ```

4. **不要在 GitHub 中提交 .env 文件**
   - 在 `.gitignore` 中添加 `.env`

5. **使用 HTTPS**
   - 所有通信都应该加密

### ❌ 不应该做的

1. 在代码中硬编码密码
2. 在 URL 中暴露密码
3. 使用简单密码
4. 忘记更换默认密码
5. 将 .env 文件上传到 GitHub

## 常见问题

### Q1：如何在微信云托管中设置环境变量？

**A：**
1. 登录微信云托管控制台
2. 进入服务 → 服务设置
3. 找到环境变量部分
4. 添加变量并保存
5. 重新部署服务

### Q2：如何验证环境变量是否生效？

**A：** 在后端代码中添加日志：

```javascript
console.log('ADMIN_PASSWORD:', process.env.ADMIN_PASSWORD)
```

然后查看服务日志。

### Q3：如果忘记了管理员密码怎么办？

**A：**
1. 在微信云托管中重新设置环境变量
2. 重新部署服务
3. 使用新密码登录

### Q4：可以有多个管理员吗？

**A：** 可以，创建多个环境变量：

```
ADMIN_PASSWORD_1=password1
ADMIN_PASSWORD_2=password2
ADMIN_PASSWORD_3=password3
```

然后在代码中检查：

```javascript
const adminPasswords = [
  process.env.ADMIN_PASSWORD_1,
  process.env.ADMIN_PASSWORD_2,
  process.env.ADMIN_PASSWORD_3
]

if (!adminPasswords.includes(password)) {
  return res.status(401).json({ message: '未授权' })
}
```

## 相关文件

- `server/routes/admin.js` - 管理员路由（包含认证逻辑）
- `server/admin/login.html` - 管理后台登录页面
- `server/admin/index.html` - 管理后台主页面
- `管理后台安全配置指南.md` - 详细的安全配置指南

## 总结

| 方面 | 说明 |
|------|------|
| **环境变量名** | ADMIN_PASSWORD |
| **默认值** | admin123 |
| **推荐设置方式** | 微信云托管环境变量 |
| **安全性** | ⭐⭐⭐⭐⭐ 高 |
| **易用性** | ⭐⭐⭐⭐ 高 |

---

**需要帮助吗？** 查看 `管理后台安全配置指南.md` 了解更多详情。

