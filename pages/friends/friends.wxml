<!--pages/friends/friends.wxml-->
<view class="container">
  <view class="header">
    <view class="title">æˆ‘çš„å¥½å‹</view>
    <view class="subtitle">æŸ¥çœ‹å¥½å‹çš„å…¬å¼€æ—¥ç¨‹</view>
  </view>

  <!-- é¡¶éƒ¨ç»Ÿè®¡æé†’ -->
  <view class="stats-reminder">
    <view class="reminder-item approved">
      <view class="reminder-label">å·²é¢„çº¦æˆåŠŸ</view>
      <view class="reminder-count">{{bookingStats.approvedCount}}</view>
    </view>
    <view class="reminder-item pending">
      <view class="reminder-label">å¾…å®¡æ‰¹ä¸­</view>
      <view class="reminder-count">{{bookingStats.pendingCount}}</view>
    </view>
    <view class="reminder-item total">
      <view class="reminder-label">æ€»è®¡</view>
      <view class="reminder-count">{{bookingStats.totalCount}}</view>
    </view>
  </view>

  <!-- é¡¶éƒ¨é¢„çº¦è¯¦æƒ…ä¿¡æ¯ -->
  <view class="booking-details">
    <!-- å·²é¢„çº¦æ—¥ç¨‹ -->
    <view class="booking-section" wx:if="{{bookingDetails.approvedBookings.length > 0}}">
      <view class="section-title">å·²é¢„çº¦</view>
      <view class="booking-item" wx:for="{{bookingDetails.approvedBookings}}" wx:key="id">
        <view class="booking-info">
          <view class="booking-date">{{item.date}}</view>
          <view class="booking-time">{{item.start_time}} - {{item.end_time}}</view>
        </view>
        <view class="booking-owner-badge">{{item.owner_name || 'å¥½å‹'}}</view>
      </view>
    </view>
    
    <!-- å®¡æ‰¹ä¸­æ—¥ç¨‹ -->
    <view class="booking-section" wx:if="{{bookingDetails.pendingBookings.length > 0}}">
      <view class="section-title pending">å¾…å®¡æ ¸</view>
      <view class="booking-item" wx:for="{{bookingDetails.pendingBookings}}" wx:key="id">
        <view class="booking-info">
          <view class="booking-date">{{item.date}}</view>
          <view class="booking-time">{{item.start_time}} - {{item.end_time}}</view>
        </view>
        <view class="booking-owner-badge pending">{{item.owner_name || 'å¥½å‹'}}</view>
      </view>
    </view>

    <!-- å¦‚æœæ²¡æœ‰é¢„çº¦ä¿¡æ¯ -->
    <view class="no-booking" wx:if="{{bookingDetails.approvedBookings.length === 0 && bookingDetails.pendingBookings.length === 0}}">
      <view class="no-booking-text">æš‚æ— é¢„çº¦æ—¥ç¨‹</view>
    </view>
  </view>

  <!-- å¥½å‹åˆ—è¡¨ -->
  <view class="friends-section">
    <view class="section-header">å¥½å‹åˆ—è¡¨</view>
    <view class="friends-list">
       <view class="friend-item" wx:for="{{friends}}" wx:key="id" bindtap="viewFriendSchedule" data-id="{{item.id}}">
         <image class="friend-avatar" src="{{item.avatar_url || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzY2N2VlYSIvPjx0ZXh0IHg9IjUwIiB5PSI1MCIgZm9udC1zaXplPSI0OCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj4nICsgaXRlbS5uYW1lLmNoYXJBdCgwKSArICc8L3RleHQ+PC9zdmc+'}}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzY2N2VlYSIvPjwvc3ZnPg=='"></image>
         <view class="friend-info">
           <view class="friend-name">{{item.name || item.nickname}}</view>
         </view>
        <view class="friend-stats">
          <view class="stat-badge available">
            <view class="stat-label">å¯é¢„çº¦</view>
            <view class="stat-count">{{item.availableCount || 0}}</view>
          </view>
          <view class="stat-badge booked">
            <view class="stat-label">æˆ‘çš„é¢„çº¦</view>
            <view class="stat-count">{{item.myBookingCount || 0}}</view>
          </view>
        </view>
        <view class="friend-arrow">></view>
      </view>

      <view class="empty" wx:if="{{friends.length === 0}}">
        <view class="empty-icon">ğŸ‘¥</view>
        <view class="empty-text">è¿˜æ²¡æœ‰å¥½å‹</view>
        <view class="empty-desc">æ·»åŠ å¥½å‹åå¯ä»¥æŸ¥çœ‹ä»–ä»¬çš„å…¬å¼€æ—¥ç¨‹</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ·»åŠ å¥½å‹æŒ‰é’® -->
  <button class="btn-add-friend" bindtap="goToAddFriend">+ æ·»åŠ å¥½å‹</button>
</view>

