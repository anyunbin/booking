<!--pages/schedule/schedule.wxml-->
<view class="container">
  <view class="header">
    <view class="title">æ—¥ç¨‹ç®¡ç†</view>
    <view class="subtitle">ç®¡ç†æ‚¨çš„æ—¥ç¨‹å®‰æ’å’Œé¢„çº¦</view>
  </view>

  <!-- åŠŸèƒ½æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab-item {{currentTab === 'schedules' ? 'active' : ''}}" bindtap="switchTab" data-tab="schedules">
      æ—¥ç¨‹è®¾ç½®
    </view>
    <view class="tab-item {{currentTab === 'requests' ? 'active' : ''}}" bindtap="switchTab" data-tab="requests">
      é¢„çº¦å®¡æ‰¹
    </view>
  </view>

  <!-- æ—¥ç¨‹è®¾ç½®æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{currentTab === 'schedules'}}">
    <view class="tab-desc">
      <text>è®¾ç½®å…·ä½“æŸä¸€å¤©çš„æ—¥ç¨‹å®‰æ’</text>
    </view>
    <view class="add-methods">
      <button class="method-btn voice-btn" bindtap="addByVoice">
        <view class="method-icon">ğŸ¤</view>
        <view class="method-text">è¯­éŸ³è®¾ç½®</view>
      </button>
      <button class="method-btn manual-btn" bindtap="addManually">
        <view class="method-icon">âœï¸</view>
        <view class="method-text">æ‰‹åŠ¨è®¾ç½®</view>
      </button>
    </view>

    <view class="schedule-list">
      <view class="date-section" wx:for="{{schedules}}" wx:key="date">
        <view class="date-header">{{item.date}}</view>
        <view class="schedule-items">
          <view class="schedule-item" wx:for="{{item.items}}" wx:key="id" wx:for-item="schedule">
            <view class="schedule-info">
              <view class="schedule-time">{{schedule.startTime}} - {{schedule.endTime}}</view>
              <view class="schedule-meta">
                <view class="schedule-status {{schedule.status}}">
                  {{schedule.status === 'booked' ? 'å·²é¢„çº¦' : schedule.status === 'pending' ? 'å¾…å®¡æ ¸' : 'ç©ºé—²'}}
                </view>
                <view class="schedule-public {{schedule.isPublic ? 'public' : 'private'}}" bindtap="togglePublic" data-id="{{schedule.id}}" data-public="{{schedule.isPublic}}">
                  {{schedule.isPublic ? 'å…¬å¼€' : 'ä¸å…¬å¼€'}}
                </view>
              </view>
            </view>
            <button class="btn-delete" size="mini" bindtap="deleteSchedule" data-id="{{schedule.id}}">åˆ é™¤</button>
          </view>
        </view>
      </view>
      
      <view class="empty" wx:if="{{schedules.length === 0}}">
        æš‚æ— æ—¥ç¨‹å®‰æ’
      </view>
    </view>
  </view>

  <!-- å¼€æ”¾æ—¶é—´æ¨¡æ¿æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{currentTab === 'timeSlots'}}">
    <view class="tab-desc">
      <text>è®¾ç½®æ¯å¤©å“ªäº›æ—¶é—´æ®µå¯ä»¥å¼€æ”¾ï¼ˆæ¨¡æ¿ï¼‰ï¼Œç”¨äºå¿«é€Ÿåˆ›å»ºæ—¥ç¨‹</text>
    </view>
    <view class="time-slots-list">
      <view class="slot-item" wx:for="{{timeSlots}}" wx:key="id">
        <view class="slot-time">{{item.start_time}} - {{item.end_time}}</view>
        <button class="btn-delete" size="mini" bindtap="deleteTimeSlot" data-id="{{item.id}}">åˆ é™¤</button>
      </view>
      
      <view class="empty" wx:if="{{timeSlots.length === 0}}">
        æš‚æ— å¼€æ”¾æ—¶é—´æ¨¡æ¿ï¼Œè¯·æ·»åŠ 
      </view>
    </view>

    <view class="add-section">
      <view class="add-title">æ·»åŠ å¼€æ”¾æ—¶é—´æ¨¡æ¿</view>
      <view class="form-group">
        <view class="label">å¼€å§‹æ—¶é—´</view>
        <picker mode="time" value="{{timeSlotStartTime}}" bindchange="onTimeSlotStartTimeChange">
          <view class="picker">{{timeSlotStartTime || 'è¯·é€‰æ‹©å¼€å§‹æ—¶é—´'}}</view>
        </picker>
      </view>
      <view class="form-group">
        <view class="label">ç»“æŸæ—¶é—´</view>
        <picker mode="time" value="{{timeSlotEndTime}}" bindchange="onTimeSlotEndTimeChange">
          <view class="picker">{{timeSlotEndTime || 'è¯·é€‰æ‹©ç»“æŸæ—¶é—´'}}</view>
        </picker>
      </view>
      <button class="btn-add" bindtap="addTimeSlot">æ·»åŠ </button>
    </view>
  </view>

  <!-- é¢„çº¦å®¡æ‰¹æ ‡ç­¾é¡µ -->
  <view class="tab-content" wx:if="{{currentTab === 'requests'}}">
    <view class="tab-desc">
      <text>å®¡æ‰¹å…¶ä»–äººé¢„çº¦æ‚¨æ—¥ç¨‹çš„è¯·æ±‚</text>
    </view>
    <view class="request-tabs">
      <view class="request-tab-item {{requestTab === 'pending' ? 'active' : ''}}" bindtap="switchRequestTab" data-tab="pending">
        å¾…å¤„ç†
      </view>
      <view class="request-tab-item {{requestTab === 'approved' ? 'active' : ''}}" bindtap="switchRequestTab" data-tab="approved">
        å·²åŒæ„
      </view>
      <view class="request-tab-item {{requestTab === 'rejected' ? 'active' : ''}}" bindtap="switchRequestTab" data-tab="rejected">
        å·²é©³å›
      </view>
    </view>

    <view class="requests-list">
      <view class="request-item" wx:for="{{requests}}" wx:key="id">
        <view class="request-info">
          <view class="request-guest">{{item.guest_name || item.guest_id}}</view>
          <view class="request-time">{{item.date}} {{item.start_time}} - {{item.end_time}}</view>
          <view class="request-note" wx:if="{{item.note}}">å¤‡æ³¨ï¼š{{item.note}}</view>
        </view>
        <view class="request-actions" wx:if="{{requestTab === 'pending'}}">
          <button class="btn-approve" size="mini" bindtap="approveRequest" data-id="{{item.id}}">åŒæ„</button>
          <button class="btn-reject" size="mini" bindtap="rejectRequest" data-id="{{item.id}}">é©³å›</button>
        </view>
        <view class="request-status" wx:else>
          <text class="status-text {{item.status}}">{{item.status === 'approved' ? 'å·²åŒæ„' : 'å·²é©³å›'}}</text>
        </view>
      </view>
      
      <view class="empty" wx:if="{{requests.length === 0}}">
        æš‚æ— {{requestTab === 'pending' ? 'å¾…å¤„ç†' : requestTab === 'approved' ? 'å·²åŒæ„' : 'å·²é©³å›'}}çš„é¢„çº¦è¯·æ±‚
      </view>
    </view>
  </view>

  <!-- æ‰‹åŠ¨æ·»åŠ æ—¥ç¨‹å¼¹çª— -->
  <view class="modal" wx:if="{{showManualModal}}" bindtap="closeModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-title">æ‰‹åŠ¨æ·»åŠ æ—¥ç¨‹</view>
      <view class="form-group">
        <view class="label">æ—¥æœŸ</view>
        <picker mode="date" value="{{scheduleDate}}" bindchange="onDateChange">
          <view class="picker">{{scheduleDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}</view>
        </picker>
      </view>
      <view class="form-group">
        <view class="label">å¼€å§‹æ—¶é—´</view>
        <picker mode="time" value="{{scheduleStartTime}}" bindchange="onScheduleStartTimeChange">
          <view class="picker">{{scheduleStartTime || 'è¯·é€‰æ‹©å¼€å§‹æ—¶é—´'}}</view>
        </picker>
      </view>
      <view class="form-group">
        <view class="label">ç»“æŸæ—¶é—´</view>
        <picker mode="time" value="{{scheduleEndTime}}" bindchange="onScheduleEndTimeChange">
          <view class="picker">{{scheduleEndTime || 'è¯·é€‰æ‹©ç»“æŸæ—¶é—´'}}</view>
        </picker>
      </view>
      <view class="form-group">
        <view class="label">æ˜¯å¦å…¬å¼€</view>
        <switch checked="{{isPublic}}" bindchange="onPublicChange" color="#667eea" />
        <text class="switch-label">{{isPublic ? 'å¥½å‹å¯è§' : 'ä»…è‡ªå·±å¯è§'}}</text>
      </view>
      <view class="form-group">
        <view class="label">æ—¶é—´æ®µæ‹†åˆ†</view>
        <switch checked="{{enableSplit}}" bindchange="onSplitChange" color="#667eea" />
        <text class="switch-label">{{enableSplit ? 'å¯ç”¨æ‹†åˆ†' : 'å•ä¸ªæ—¶é—´æ®µ'}}</text>
      </view>
      <view class="form-group" wx:if="{{enableSplit}}">
        <view class="label">æ‹†åˆ†é—´éš”</view>
        <picker mode="selector" range="{{splitIntervals}}" range-key="label" value="{{splitIntervalIndex}}" bindchange="onSplitIntervalChange">
          <view class="picker">{{splitIntervals[splitIntervalIndex].label}}</view>
        </picker>
        <view class="split-preview" wx:if="{{scheduleStartTime && scheduleEndTime && enableSplit}}">
          <view class="preview-title">é¢„è§ˆæ‹†åˆ†ç»“æœï¼š</view>
          <view class="preview-items">
            <view class="preview-item" wx:for="{{splitPreview}}" wx:key="index">
              {{item.startTime}} - {{item.endTime}}
            </view>
          </view>
        </view>
      </view>
      <view class="modal-buttons">
        <button class="btn-cancel" bindtap="closeModal">å–æ¶ˆ</button>
        <button class="btn-confirm" bindtap="confirmAddSchedule">ç¡®è®¤</button>
      </view>
    </view>
  </view>
</view>

