# 查看服务器访问日志

## 方法一：在终端查看实时日志（推荐）

### 1. 启动服务器
```bash
cd /Users/anyunbin/LLM/booking
npm start
```

### 2. 查看日志
服务器启动后，所有请求日志会实时显示在终端中，格式如下：

```
[2025-01-28T10:30:45.123Z] GET /api/schedules?userId=user_123 - IP: ::1
🟢 [2025-01-28T10:30:45.125Z] GET /api/schedules?userId=user_123 - 200 - 2ms

[2025-01-28T10:30:50.456Z] POST /api/schedules - IP: ::1
  Body: {
    "date": "2025-11-28",
    "startTime": "11:00",
    "endTime": "12:00",
    "userId": "user_123",
    "isPublic": true
  }
🟢 [2025-01-28T10:30:50.458Z] POST /api/schedules - 200 - 2ms
```

### 日志格式说明

- **时间戳**：`[2025-01-28T10:30:45.123Z]` - ISO 格式的时间
- **请求方法**：`GET`, `POST`, `PUT`, `DELETE` 等
- **请求路径**：`/api/schedules`
- **IP地址**：客户端IP地址
- **状态码颜色**：
  - 🟢 绿色：成功（200-299）
  - 🟡 黄色：客户端错误（400-499）
  - 🔴 红色：服务器错误（500+）
- **响应时间**：请求处理耗时（毫秒）

## 方法二：将日志保存到文件

### 1. 使用重定向保存日志

```bash
# 启动服务器并将日志保存到文件
npm start > server.log 2>&1

# 或者同时显示在终端和保存到文件（macOS/Linux）
npm start 2>&1 | tee server.log
```

### 2. 查看日志文件

```bash
# 查看完整日志
cat server.log

# 查看最后100行
tail -n 100 server.log

# 实时查看日志（类似 tail -f）
tail -f server.log
```

### 3. 过滤日志

```bash
# 只查看错误日志
grep "🔴" server.log

# 只查看POST请求
grep "POST" server.log

# 查看特定API的请求
grep "/api/schedules" server.log

# 查看慢请求（超过100ms）
grep -E "[0-9]{3,}ms" server.log
```

## 方法三：使用开发模式（自动重启 + 日志）

```bash
# 使用 nodemon（自动重启）
npm run dev

# 日志会实时显示，代码修改后自动重启
```

## 日志内容说明

### 请求日志包含：

1. **请求信息**：
   - 时间戳
   - HTTP方法（GET/POST等）
   - 请求路径
   - 客户端IP地址

2. **请求体**（如果有）：
   - POST/PUT请求的JSON数据
   - 自动格式化显示

3. **响应信息**：
   - 状态码（带颜色标识）
   - 处理耗时

### 示例日志

```
[2025-01-28T10:30:45.123Z] GET /api/schedules?userId=user_123 - IP: ::1
🟢 [2025-01-28T10:30:45.125Z] GET /api/schedules?userId=user_123 - 200 - 2ms

[2025-01-28T10:30:50.456Z] POST /api/schedules - IP: 192.168.1.100
  Body: {
    "date": "2025-11-28",
    "startTime": "11:00",
    "endTime": "12:00",
    "userId": "user_123",
    "isPublic": true
  }
🟢 [2025-01-28T10:30:50.458Z] POST /api/schedules - 200 - 2ms

[2025-01-28T10:31:00.789Z] GET /api/schedules/999 - IP: ::1
🟡 [2025-01-28T10:31:00.790Z] GET /api/schedules/999 - 404 - 1ms
```

## 高级用法

### 1. 查看特定时间段的日志

```bash
# 查看今天的日志
grep "2025-01-28" server.log

# 查看特定时间段的日志
grep "2025-01-28T10:" server.log
```

### 2. 统计请求数量

```bash
# 统计总请求数
wc -l server.log

# 统计各HTTP方法的请求数
grep -c "GET" server.log
grep -c "POST" server.log
```

### 3. 查找错误

```bash
# 查找所有错误请求
grep -E "(🔴|🟡)" server.log

# 查找500错误
grep " - 5[0-9][0-9] -" server.log
```

### 4. 性能分析

```bash
# 查找慢请求（超过100ms）
grep -E "[0-9]{3,}ms" server.log

# 查找最慢的10个请求
grep -E "[0-9]+ms" server.log | sort -t'-' -k3 -n -r | head -10
```

## 清理日志

```bash
# 清空日志文件
> server.log

# 或者删除日志文件
rm server.log
```

## 注意事项

1. **日志文件大小**：长时间运行会产生大量日志，建议定期清理或使用日志轮转
2. **敏感信息**：日志中可能包含用户数据，注意保护隐私
3. **性能影响**：详细的日志记录可能略微影响性能，生产环境建议使用专业的日志工具

## 生产环境建议

在生产环境中，建议使用专业的日志工具：
- **Winston**：功能强大的Node.js日志库
- **Morgan**：Express HTTP请求日志中间件
- **PM2**：进程管理器，自带日志管理功能

